
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="examples/">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38">
    
    
      
        <title>pytest_cases</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pytest-cases" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="pytest_cases" class="md-header__button md-logo" aria-label="pytest_cases" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pytest_cases
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/smarie/python-pytest-cases" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="pytest_cases" class="md-nav__button md-logo" aria-label="pytest_cases" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    pytest_cases
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/smarie/python-pytest-cases" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Home
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#citing" class="md-nav__link">
    <span class="md-ellipsis">
      Citing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing" class="md-nav__link">
    <span class="md-ellipsis">
      Installing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-pytest-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Why pytest-cases ?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Basic usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-case-functions" class="md-nav__link">
    <span class="md-ellipsis">
      a- Case functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-test-functions" class="md-nav__link">
    <span class="md-ellipsis">
      b- Test functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools-for-daily-use" class="md-nav__link">
    <span class="md-ellipsis">
      Tools for daily use
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tools for daily use">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-cases-collection" class="md-nav__link">
    <span class="md-ellipsis">
      a- Cases collection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="a- Cases collection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alternate-sources" class="md-nav__link">
    <span class="md-ellipsis">
      Alternate source(s)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternate-prefix" class="md-nav__link">
    <span class="md-ellipsis">
      Alternate prefix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filters-and-tags" class="md-nav__link">
    <span class="md-ellipsis">
      Filters and tags
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-case-functions" class="md-nav__link">
    <span class="md-ellipsis">
      b- Case functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="b- Case functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-case-name" class="md-nav__link">
    <span class="md-ellipsis">
      Custom case name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytest-marks-skip-xfail" class="md-nav__link">
    <span class="md-ellipsis">
      Pytest marks (skip, xfail...)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-generators" class="md-nav__link">
    <span class="md-ellipsis">
      Case generators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cases-requiring-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Cases requiring fixtures
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced topics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced topics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-scope-of-cases" class="md-nav__link">
    <span class="md-ellipsis">
      a- Scope of cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-parametrizing-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      b- Parametrizing fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-caching-cases" class="md-nav__link">
    <span class="md-ellipsis">
      c- Caching cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-accessing-the-current-case" class="md-nav__link">
    <span class="md-ellipsis">
      d- Accessing the current case
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e-test-ids" class="md-nav__link">
    <span class="md-ellipsis">
      e- Test ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#f-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      f- Debugging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      Main features / benefits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      See Also
    </span>
  </a>
  
    <nav class="md-nav" aria-label="See Also">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pytest" class="md-nav__link">
    <span class="md-ellipsis">
      pytest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#others" class="md-nav__link">
    <span class="md-ellipsis">
      Others
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" class="md-nav__link">
    <span class="md-ellipsis">
      Want to contribute ?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="pytest_goodies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pytest goodies
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="unions_theory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fixture unions theory
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="api_reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#citing" class="md-nav__link">
    <span class="md-ellipsis">
      Citing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing" class="md-nav__link">
    <span class="md-ellipsis">
      Installing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-pytest-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Why pytest-cases ?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Basic usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-case-functions" class="md-nav__link">
    <span class="md-ellipsis">
      a- Case functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-test-functions" class="md-nav__link">
    <span class="md-ellipsis">
      b- Test functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools-for-daily-use" class="md-nav__link">
    <span class="md-ellipsis">
      Tools for daily use
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tools for daily use">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-cases-collection" class="md-nav__link">
    <span class="md-ellipsis">
      a- Cases collection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="a- Cases collection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alternate-sources" class="md-nav__link">
    <span class="md-ellipsis">
      Alternate source(s)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternate-prefix" class="md-nav__link">
    <span class="md-ellipsis">
      Alternate prefix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filters-and-tags" class="md-nav__link">
    <span class="md-ellipsis">
      Filters and tags
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-case-functions" class="md-nav__link">
    <span class="md-ellipsis">
      b- Case functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="b- Case functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-case-name" class="md-nav__link">
    <span class="md-ellipsis">
      Custom case name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytest-marks-skip-xfail" class="md-nav__link">
    <span class="md-ellipsis">
      Pytest marks (skip, xfail...)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-generators" class="md-nav__link">
    <span class="md-ellipsis">
      Case generators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cases-requiring-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Cases requiring fixtures
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced topics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced topics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-scope-of-cases" class="md-nav__link">
    <span class="md-ellipsis">
      a- Scope of cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-parametrizing-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      b- Parametrizing fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-caching-cases" class="md-nav__link">
    <span class="md-ellipsis">
      c- Caching cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-accessing-the-current-case" class="md-nav__link">
    <span class="md-ellipsis">
      d- Accessing the current case
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e-test-ids" class="md-nav__link">
    <span class="md-ellipsis">
      e- Test ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#f-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      f- Debugging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      Main features / benefits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      See Also
    </span>
  </a>
  
    <nav class="md-nav" aria-label="See Also">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pytest" class="md-nav__link">
    <span class="md-ellipsis">
      pytest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#others" class="md-nav__link">
    <span class="md-ellipsis">
      Others
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" class="md-nav__link">
    <span class="md-ellipsis">
      Want to contribute ?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="pytest-cases">pytest-cases<a class="headerlink" href="#pytest-cases" title="Permanent link">&para;</a></h1>
<p><em>Separate test code from test cases in <code>pytest</code>.</em></p>
<p><a href="https://pypi.python.org/pypi/pytest-cases/"><img alt="Python versions" src="https://img.shields.io/pypi/pyversions/pytest-cases.svg" /></a> <img alt="Pytest versions" src="https://img.shields.io/badge/pytest-3%20%7C%204%20%7C%205%20%7C%206%20%7C%207%20%7C%208-blue" /> <a href="https://github.com/smarie/python-pytest-cases/actions/workflows/base.yml"><img alt="Build Status" src="https://github.com/smarie/python-pytest-cases/actions/workflows/base.yml/badge.svg" /></a>  <a href="reports/junit/report.html"><img alt="Tests Status" src="reports/junit/junit-badge.svg?dummy=8484744" /></a> <a href="reports/coverage/"><img alt="Coverage Status" src="reports/coverage/coverage-badge.svg?dummy=8484744" /></a> <a href="https://codecov.io/gh/smarie/python-pytest-cases"><img alt="codecov" src="https://codecov.io/gh/smarie/python-pytest-cases/branch/main/graph/badge.svg" /></a> <a href="reports/flake8/"><img alt="Flake8 Status" src="reports/flake8/flake8-badge.svg?dummy=8484744" /></a></p>
<p><a href="https://smarie.github.io/python-pytest-cases/"><img alt="Documentation" src="https://img.shields.io/badge/doc-latest-blue.svg" /></a> <a href="https://pypi.python.org/pypi/pytest-cases/"><img alt="PyPI" src="https://img.shields.io/pypi/v/pytest-cases.svg" /></a> <a href="https://pepy.tech/project/pytest-cases"><img alt="Downloads" src="https://pepy.tech/badge/pytest-cases" /></a> <a href="https://pepy.tech/project/pytest-cases"><img alt="Downloads per week" src="https://pepy.tech/badge/pytest-cases/week" /></a> <a href="https://github.com/smarie/python-pytest-cases/stargazers"><img alt="GitHub stars" src="https://img.shields.io/github/stars/smarie/python-pytest-cases.svg" /></a>
<a href="https://doi.org/10.5281/zenodo.3937829"><img alt="DOI" src="https://zenodo.org/badge/DOI/10.5281/zenodo.3937829.svg" /></a></p>
<div class="admonition success">
<p class="admonition-title">Slides from the <code>pytest-cases</code> presentation at EuroPython 2021 are now <a href="https://ep2021.europython.eu/talks/649sqwq-powerful-tests-and-reproducible-benchmarks-with-pytest-cases/">available here</a>.</p>
</div>
<div class="admonition success">
<p class="admonition-title">New <code>current_cases</code> fixture to easily know the current case for each parameter ! See <a href="#d-accessing-the-current-case">below</a> for details.</p>
</div>
<p>Did you ever think that most of your test functions were actually <em>the same test code</em>, but with <em>different data inputs</em> and expected results/exceptions ?</p>
<ul>
<li>
<p><code>pytest-cases</code> leverages <code>pytest</code> and its great <code>@pytest.mark.parametrize</code> decorator, so that you can <strong>separate your test cases from your test functions</strong>.</p>
</li>
<li>
<p>In addition, <code>pytest-cases</code> provides <a href="pytest_goodies/">several useful goodies</a> to empower <code>pytest</code>. In particular it improves the fixture mechanism to support "fixture unions". This is a <strong>major change</strong> in the internal <code>pytest</code> engine, unlocking many possibilities such as using fixture references as parameter values in a test function. See <a href="pytest_goodies/">here</a>.</p>
</li>
</ul>
<p><code>pytest-cases</code> is fully compliant with <a href="https://smarie.github.io/python-pytest-harvest/">pytest-harvest</a> so you can easily monitor the execution times and created artifacts. With it, it becomes very easy to create a complete data science benchmark, for example comparing various models on various datasets as illustrated below (from the <a href="examples/">example</a> section):</p>
<p><img alt="benchmark_plots_example" src="imgs/0_bench_plots_example4.png" /></p>
<h2 id="citing">Citing<a class="headerlink" href="#citing" title="Permanent link">&para;</a></h2>
<p>If <code>pytest-cases</code> helps you with your research work, don't hesitate to spread the word ! For this simply use this Zenodo link <a href="https://doi.org/10.5281/zenodo.3937829"><img alt="DOI" src="https://zenodo.org/badge/DOI/10.5281/zenodo.3937829.svg" /></a> to get the proper citation entry (at the bottom right of the page, many formats available including BibTeX).</p>
<h2 id="installing">Installing<a class="headerlink" href="#installing" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>&gt;<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pytest-cases
</code></pre></div>
<p>Note: Installing pytest-cases has effects on the order of <code>pytest</code> tests execution, even if you do not use its features. One positive side effect is that it fixed <a href="https://github.com/pytest-dev/pytest/issues/5054">pytest#5054</a>. But if you see less desirable ordering please <a href="https://github.com/smarie/python-pytest-cases/issues">report it</a>.</p>
<h2 id="why-pytest-cases">Why <code>pytest-cases</code> ?<a class="headerlink" href="#why-pytest-cases" title="Permanent link">&para;</a></h2>
<p><strong><code>pytest</code> philosophy</strong></p>
<p>Let's consider the following <code>foo</code> function under test, located in <code>example.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div>
<p>If we were using plain <code>pytest</code> to test it with various inputs, we would create a <code>test_foo.py</code> file and use <code>@pytest.mark.parametrize</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">example</span> <span class="kn">import</span> <span class="n">foo</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;a,b&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c1"># check that foo runs correctly and that the result is a tuple. </span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">)</span>
</code></pre></div>
<p>This is the fastest and most compact thing to do when you have a few number of test cases, that do not require code to generate each test case. </p>
<p><strong><code>pytest</code> current limitations</strong></p>
<p>Now imagine that instead of <code>(1, 2)</code> and <code>(-1, -2)</code> <strong>each</strong> of our test cases </p>
<ul>
<li>requires <strong>a few lines of code</strong> to be generated. For example artificial data creation using <code>numpy</code> and/or <code>pandas</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># case 1: non-sorted uniformly sampled timeseries with 2 holes</span>
<span class="n">case1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;20/1/1&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> 
                                                <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;-1d&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">),</span>
                      <span class="s2">&quot;data1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
                      <span class="s2">&quot;data2&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span>
                      <span class="s2">&quot;data3&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">)})</span>
<span class="n">case1</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>
<p>requires <strong>documentation</strong> to explain the other developers the intent of that precise test case</p>
</li>
<li>
<p>requires <strong>external resources</strong> (data files on the filesystem, databases...), with a variable number of cases depending on what is available on the resource - but of course not all the cases would come from the same resource, that would be too easy :).</p>
</li>
<li>
<p>requires <strong>a readable <code>id</code></strong>, such as <code>'uniformly_sampled_nonsorted_with_holes'</code> for the above example. Of course we <em>could</em> use <a href="https://docs.pytest.org/en/stable/example/parametrize.html#set-marks-or-test-id-for-individual-parametrized-test"><code>pytest.param</code></a> or <a href="https://docs.pytest.org/en/stable/example/parametrize.html#different-options-for-test-ids"><code>ids=&lt;list&gt;</code></a> but that is "a pain to maintain" according to <code>pytest</code> doc (I agree!). Such a design does not feel right as the id is detached from the case.</p>
</li>
</ul>
<p>With standard <code>pytest</code> there is no particular pattern to simplify your life here. Investigating a little bit, people usually end up trying to mix parameters and fixtures and asking this kind of question: <a href="https://stackoverflow.com/questions/50231627/python-pytest-unpack-fixture">so1</a>, <a href="https://stackoverflow.com/questions/50482416/use-pytest-lazy-fixture-list-values-as-parameters-in-another-fixture">so2</a>. But by design it is not possible to solve this problem using fixtures, because <code>pytest</code> <a href="pytest_goodies/#fixture_union">does not handle "unions" of fixtures</a>.</p>
<p>So all in all, the final answer is "you have to do this yourself", and have <code>pytest</code> use your handcrafted list of parameters as the list of argvalues in <code>@pytest.mark.parametrize</code>. Typically we would end up creating a <code>get_all_foo_test_cases</code> function, independently from <code>pytest</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;a,b&quot;</span><span class="p">,</span> <span class="n">get_all_foo_test_cases</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div>
<p>There is also an example in <code>pytest</code> doc <a href="https://docs.pytest.org/en/stable/example/parametrize.html#a-quick-port-of-testscenarios">with a <code>metafunc</code> hook</a>. </p>
<p>The issue with such workarounds is that you can do <em>anything</em>. And <em>anything</em> is a bit too much: this does not provide any convention / "good practice" on how to organize test cases, which is an open door to developing ad-hoc unreadable or unmaintainable solutions.</p>
<p><code>pytest_cases</code> was created to provide an answer to this precise situation. It proposes a simple framework to separate test cases from test functions. The test cases are typically located in a separate "companion" file:</p>
<ul>
<li><code>test_foo.py</code> is your usual test file containing the test <strong>functions</strong> (named <code>test_&lt;id&gt;</code>),</li>
<li><code>test_foo_cases.py</code> contains the test <strong>cases</strong>, that are also functions (named <code>case_&lt;id&gt;</code> or even <code>&lt;prefix&gt;_&lt;id&gt;</code> if you prefer). Note: an alternate file naming style <code>cases_foo.py</code> is also available if you prefer it.</li>
</ul>
<p><img alt="files_overview" src="imgs/1_files_overview.png" /></p>
<p>Test cases can also be provided explicitly, for example in a class container:</p>
<p><img alt="class_overview" src="imgs/2_class_overview.png" /></p>
<p>And many more as we'll see <a href="#a-cases-collection">below</a>.</p>
<h2 id="basic-usage">Basic usage<a class="headerlink" href="#basic-usage" title="Permanent link">&para;</a></h2>
<h3 id="a-case-functions">a- Case functions<a class="headerlink" href="#a-case-functions" title="Permanent link">&para;</a></h3>
<p>Let's create a <code>test_foo_cases.py</code> file. This file will contain <em>test cases generator functions</em>, that we will call <strong>case functions</strong> for brevity. In these functions, you will typically either parse some test data files, generate some simulated test data, expected results, etc.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">case_two_positive_ints</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Inputs are two positive integers &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">case_two_negative_ints</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Inputs are two negative integers &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span>
</code></pre></div>
<p>Case functions <strong>do not have any particular requirement</strong>, apart from the default name convention <code>case_&lt;id&gt;</code> - but even that can be customized: <strong>you can use distinct prefixes</strong> to denote distinct kind of parameters, such as <code>data_&lt;id&gt;</code>, <code>user_&lt;id&gt;</code>, <code>model_&lt;id&gt;</code>... </p>
<p>Case functions can return anything that is considered useful to run the associated test. We will see <a href="#b-case-functions">below</a> that you can use all classic pytest mechanism on case functions (id customization, skip/fail marks, parametrization, fixtures injection).</p>
<h3 id="b-test-functions">b- Test functions<a class="headerlink" href="#b-test-functions" title="Permanent link">&para;</a></h3>
<p>As usual we write our <code>pytest</code> test functions starting with <code>test_</code>, in a <code>test_foo.py</code> file. The only difference is that we now decorate it with <code>@parametrize_with_cases</code> instead of <code>@pytest.mark.parametrize</code> as we were doing <a href="#why-pytest-cases">previously</a>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">example</span> <span class="kn">import</span> <span class="n">foo</span>
<span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">parametrize_with_cases</span>

<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;a,b&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c1"># check that foo runs correctly and that the result is a tuple. </span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">)</span>
</code></pre></div>
<p>As simple as that ! The syntax is basically the same than in <a href="https://docs.pytest.org/en/stable/example/parametrize.html"><code>pytest.mark.parametrize</code></a>.</p>
<p>Executing <code>pytest</code> will now run our test function <strong>once for every case function</strong>:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt;<span class="w"> </span>pytest<span class="w"> </span>-s<span class="w"> </span>-v
<span class="o">=============================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">=============================</span>
<span class="o">(</span>...<span class="o">)</span>
&lt;your_project&gt;/tests/test_foo.py::test_foo<span class="o">[</span>two_positive_ints<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
&lt;your_project&gt;/tests/test_foo.py::test_foo<span class="o">[</span>two_negative_ints<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==========================</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.24<span class="w"> </span><span class="nv">seconds</span><span class="w"> </span><span class="o">==========================</span>
</code></pre></div>
<h2 id="tools-for-daily-use">Tools for daily use<a class="headerlink" href="#tools-for-daily-use" title="Permanent link">&para;</a></h2>
<h3 id="a-cases-collection">a- Cases collection<a class="headerlink" href="#a-cases-collection" title="Permanent link">&para;</a></h3>
<h4 id="alternate-sources">Alternate source(s)<a class="headerlink" href="#alternate-sources" title="Permanent link">&para;</a></h4>
<p>It is not mandatory that case functions should be in a different file than the test functions: both can be in the same file. For this you can use <code>cases='.'</code> or <code>cases=THIS_MODULE</code> to refer to the module in which the test function is located:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">parametrize_with_cases</span>

<span class="k">def</span> <span class="nf">case_one_positive_int</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">case_one_negative_int</span><span class="p">():</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_this_module</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</code></pre></div>
<p>However <strong>WARNING</strong>: only the case functions defined BEFORE the test function in the module file will be taken into account!</p>
<p><code>@parametrize_with_cases(cases=...)</code> also accepts explicit list of case functions, classes containing case functions, and modules. See <a href="api_reference/#parametrize_with_cases">API Reference</a> for details. A typical way to organize cases is to use classes for example:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">parametrize_with_cases</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">case_a_positive_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">case_another_positive_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span>

<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="n">Foo</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div>
<p>Note that as for <code>pytest</code>, <code>self</code> is recreated for every test and therefore should not be used to store any useful information. </p>
<h4 id="alternate-prefix">Alternate prefix<a class="headerlink" href="#alternate-prefix" title="Permanent link">&para;</a></h4>
<p><code>case_</code> might not be your preferred prefix, especially if you wish to store in the same module or class various <strong>kind</strong> of case data. <code>@parametrize_with_cases</code> offers a <code>prefix=...</code> argument to select an alternate prefix for your case functions. That way, you can store <strong>in the same module or class</strong> case functions as diverse as datasets (e.g. <code>data_</code>), user descriptions (e.g. <code>user_</code>), algorithms or machine learning models (e.g. <code>model_</code> or <code>algo_</code>), etc.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">parametrize_with_cases</span><span class="p">,</span> <span class="n">parametrize</span>

<span class="k">def</span> <span class="nf">data_a</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;a&#39;</span>

<span class="nd">@parametrize</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">data_b</span><span class="p">(</span><span class="n">hello</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;hello&quot;</span> <span class="k">if</span> <span class="n">hello</span> <span class="k">else</span> <span class="s2">&quot;world&quot;</span>

<span class="k">def</span> <span class="nf">case_c</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;hi i&#39;m not used&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">user_bob</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;bob&quot;</span>

<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;data_&quot;</span><span class="p">)</span>
<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;user_&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">user</span> <span class="o">==</span> <span class="s1">&#39;bob&#39;</span>
</code></pre></div>
<p>yields</p>
<div class="highlight"><pre><span></span><code>test_doc_filters_n_tags.py::test_with_data[bob-a]       PASSED [ 33%]
test_doc_filters_n_tags.py::test_with_data[bob-b-True]   PASSED [ 66%]
test_doc_filters_n_tags.py::test_with_data[bob-b-False]   PASSED [ 100%]
</code></pre></div>
<h4 id="filters-and-tags">Filters and tags<a class="headerlink" href="#filters-and-tags" title="Permanent link">&para;</a></h4>
<p>The easiest way to select only a subset of case functions in a module or a class, is to specify a custom <code>prefix</code> instead of the default one (<code>'case_'</code>), as shown <a href="#alternate-prefix">above</a>.</p>
<p>However sometimes more advanced filtering is required. In that case, you can also rely on three additional mechanisms provided in <code>@parametrize_with_cases</code>:</p>
<ul>
<li>the <code>glob</code> argument can contain a glob-like pattern for case ids. This can become handy to separate for example good or bad cases, the latter returning an expected error type and/or message for use with <code>pytest.raises</code> or with our alternative <a href="pytest_goodies/#assert_exception"><code>assert_exception</code></a>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">parametrize_with_cases</span>


<span class="k">def</span> <span class="nf">case_int_success</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">case_negative_int_failure</span><span class="p">():</span>
    <span class="c1"># note that we decide to return the expected type of failure to check it</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s2">&quot;math domain error&quot;</span>


<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">glob</span><span class="o">=</span><span class="s2">&quot;*success&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_good_datasets</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;data, err_type, err_msg&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">glob</span><span class="o">=</span><span class="s2">&quot;*failure&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_bad_datasets</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">err_type</span><span class="p">,</span> <span class="n">err_msg</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">err_type</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">err_msg</span><span class="p">):</span>
        <span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>the <code>has_tag</code> argument allows you to filter cases based on tags set on case functions using the <code>@case</code> decorator. See API reference of <a href="api_reference/#case"><code>@case</code></a> and <a href="api_reference/#parametrize_with_cases"><code>@parametrize_with_cases</code></a>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">parametrize_with_cases</span><span class="p">,</span> <span class="n">case</span>

<span class="k">class</span> <span class="nc">FooCases</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">case_two_positive_ints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>

    <span class="nd">@case</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">case_one_positive_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>

<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="n">FooCases</span><span class="p">,</span> <span class="n">has_tag</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div>
<ul>
<li>Finally if none of the above matches your expectations, you can provide a callable to <code>filter</code>. This callable will receive each collected case function and should return <code>True</code> (or a truth-value convertible object) in case of success. Note that your function can leverage the <code>get_case_id</code>, <code>get_case_marks</code>, <code>get_case_tags</code> etc. helper functions to read the tags, marks and id found on it. See <a href="api_reference/#get_case_id">API doc</a>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">get_case_id</span>

<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> 
                        <span class="nb">filter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">cf</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span> <span class="ow">in</span> <span class="n">get_case_id</span><span class="p">(</span><span class="n">cf</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">test_good_datasets2</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div>
<ul>
<li>An array of default filters is available in the <code>filters</code> module: <code>has_tag</code>, <code>id_has_prefix</code>, etc. You can use logical operations on them such as "and" (<code>&amp;</code>) "or" (<code>|</code>) and "not" (<code>~</code>) in order to create your own custom filters. See <a href="api_reference/#the-filters-submodule">API reference</a> for details.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">filters</span> <span class="k">as</span> <span class="n">ft</span>


<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                        <span class="nb">filter</span><span class="o">=</span><span class="n">ft</span><span class="o">.</span><span class="n">has_tag</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ft</span><span class="o">.</span><span class="n">id_has_prefix</span><span class="p">(</span><span class="s2">&quot;case_b&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_good_datasets3</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div>
<h3 id="b-case-functions">b- Case functions<a class="headerlink" href="#b-case-functions" title="Permanent link">&para;</a></h3>
<h4 id="custom-case-name">Custom case name<a class="headerlink" href="#custom-case-name" title="Permanent link">&para;</a></h4>
<p>The id used by <code>pytest</code> for a given case is automatically taken from the case function name by removing the <code>case_</code> (or other custom) prefix. It can instead be customized explicitly by decorating your case function with the <code>@case(id=&lt;id&gt;)</code> decorator. See <a href="api_reference/#case">API reference</a>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">case</span>

<span class="nd">@case</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;2 positive integers&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">case_two_positive_ints</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
</code></pre></div>
<h4 id="pytest-marks-skip-xfail">Pytest marks (<code>skip</code>, <code>xfail</code>...)<a class="headerlink" href="#pytest-marks-skip-xfail" title="Permanent link">&para;</a></h4>
<p>pytest marks such as <code>@pytest.mark.skipif</code> can be applied on case functions the same way <a href="https://docs.pytest.org/en/stable/skipping.html">as with test functions</a>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Not useful on python 2&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">case_two_positive_ints</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
</code></pre></div>
<h4 id="case-generators">Case generators<a class="headerlink" href="#case-generators" title="Permanent link">&para;</a></h4>
<p>In many real-world usage we want to generate one test case <em>per</em> <code>&lt;something&gt;</code>. The most intuitive way would be to use a <code>for</code> loop to create the case functions, and to use the <code>@case</code> decorator to set their names ; however this would not be very readable.</p>
<p>Instead, case functions can be parametrized the same way <a href="https://docs.pytest.org/en/stable/parametrize.html">as with test functions</a>: simply add the parameter names as arguments in their signature and decorate with <code>@pytest.mark.parametrize</code>. Even better, you can use the enhanced <a href="api_reference/#parametrize"><code>@parametrize</code></a> from <code>pytest-cases</code> so as to benefit from its additional usability features (see <a href="api_reference/#parametrize">API reference</a>):</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">parametrize</span><span class="p">,</span> <span class="n">parametrize_with_cases</span>

<span class="k">class</span> <span class="nc">CasesFoo</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">case_hello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;hello world&quot;</span>

    <span class="nd">@parametrize</span><span class="p">(</span><span class="n">who</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;you&#39;</span><span class="p">,</span> <span class="s1">&#39;there&#39;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">case_simple_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">who</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;hello </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">who</span>


<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;msg&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="n">CasesFoo</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Yields</p>
<div class="highlight"><pre><span></span><code>test_generators.py::test_foo[hello] PASSED               [ 33%]
test_generators.py::test_foo[simple_generator-who=you] PASSED [ 66%]
test_generators.py::test_foo[simple_generator-who=there] PASSED [100%]
</code></pre></div>
<h4 id="cases-requiring-fixtures">Cases requiring fixtures<a class="headerlink" href="#cases-requiring-fixtures" title="Permanent link">&para;</a></h4>
<p>Cases can use fixtures the same way as <a href="https://docs.pytest.org/en/stable/fixture.html#fixtures-as-function-arguments">test functions do</a>: simply add the fixture names as arguments in their signature and make sure the fixture exists or is imported either in the module where <code>@parametrize_with_cases</code> is used, or in a <a href="https://docs.pytest.org/en/stable/fixture.html?highlight=conftest.py#conftest-py-sharing-fixture-functions"><code>conftest.py</code></a> file in one of the parent packages. </p>
<p>See <a href="https://docs.pytest.org/en/stable/fixture.html?highlight=conftest.py#conftest-py-sharing-fixture-functions"><code>pytest</code> documentation on sharing fixtures</a>and this <a href="https://gist.github.com/peterhurford/09f7dcda0ab04b95c026c60fa49c2a68">blog</a>.</p>
<p>You can use the <strong>experimental</strong> <code>@parametrize_with_cases(import_fixtures=True)</code> argument to perform the import automatically for you, see <a href="api_reference/#parametrize_with_cases">API reference</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Use <code>@fixture</code> instead of <code>@pytest.fixture</code></p>
<p>If a fixture is used by <em>some</em> of your cases only, then you <em>should</em> use the <code>@fixture</code> decorator from pytest-cases instead of the standard <code>@pytest.fixture</code>. Otherwise you fixture will be setup/teardown for all cases even those not requiring it. See <a href="api_reference/#fixture"><code>@fixture</code> doc</a>.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">parametrize_with_cases</span><span class="p">,</span> <span class="n">fixture</span><span class="p">,</span> <span class="n">parametrize</span>

<span class="nd">@fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;session&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">db</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;louise&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;bob&#39;</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">user_bob</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">db</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="nd">@parametrize</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">user_from_db</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">db</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>

<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;user_&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_users</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this is test </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">request</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">nodeid</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</code></pre></div>
<p>yields</p>
<div class="highlight"><pre><span></span><code>test_fixtures.py::test_users[a_is_bob] 
test_fixtures.py::test_users[a_is_from_db-id=0] 
test_fixtures.py::test_users[a_is_from_db-id=1] 
</code></pre></div>
<h2 id="advanced-topics">Advanced topics<a class="headerlink" href="#advanced-topics" title="Permanent link">&para;</a></h2>
<h3 id="a-scope-of-cases">a- Scope of cases<a class="headerlink" href="#a-scope-of-cases" title="Permanent link">&para;</a></h3>
<p>By default a case function is transformed into a lazy <em>parameter</em> using <a href="api_reference/#lazy_value"><code>lazy_value</code></a>. This is not a <em>fixture</em>, but simply a new <code>parametrize</code> mechanism that allows parameters to be provided by functions (See <a href="pytest_goodies/#parametrize"><code>@parametrize</code></a>).</p>
<p>However, as soon as a case function is either parametrized or requires a fixture, then it is automatically transformed into a fixture so that <code>pytest</code> can handle it properly. In that situation, the fixture needs to have a scope. By default this scope is <code>"function"</code>. You can change it using <a href="api_reference/#parametrize_with_cases">the <code>scope</code> argument in <code>@parametrize_with_cases</code></a>.</p>
<h3 id="b-parametrizing-fixtures">b- Parametrizing fixtures<a class="headerlink" href="#b-parametrizing-fixtures" title="Permanent link">&para;</a></h3>
<p>In some scenarii you might wish to parametrize a fixture with the cases, rather than the test function. For example </p>
<ul>
<li>
<p>to inject the same test cases in several test functions <strong>without duplicating</strong> the <code>@parametrize_with_cases</code> decorator on each of them,</p>
</li>
<li>
<p>to generate the test cases <strong>once</strong> for the whole session, using a <code>scope='session'</code> fixture or <a href="https://docs.pytest.org/en/stable/fixture.html#scope-sharing-a-fixture-instance-across-tests-in-a-class-module-or-session">another scope</a>,</p>
</li>
<li>
<p>to modify the test cases, log some message, or perform some other action <strong>before injecting them</strong> into the test functions, and/or <strong>after executing</strong> the test function (thanks to <a href="https://docs.pytest.org/en/stable/fixture.html#fixture-finalization-executing-teardown-code">yield fixtures</a>)</p>
</li>
<li>
<p>...</p>
</li>
</ul>
<p>For this, simply use <code>@fixture</code> from <code>pytest_cases</code> instead of <code>@pytest.fixture</code> to define your fixture. That allows your fixtures to be easily parametrized with <code>@parametrize_with_cases</code>, <code>@parametrize</code>, and even <code>@pytest.mark.parametrize</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">fixture</span><span class="p">,</span> <span class="n">parametrize_with_cases</span>

<span class="nd">@fixture</span>
<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;a,b&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</code></pre></div>
<h3 id="c-caching-cases">c- Caching cases<a class="headerlink" href="#c-caching-cases" title="Permanent link">&para;</a></h3>
<p>After starting to reuse cases in several test functions, you might end-up thinking <em>"why do I have to spend the data parsing/generation time several times ? It is the same case."</em>. </p>
<p><code>pytest-cases</code> follows the same philosophy than <code>pytest</code>: each test node should be independent. Therefore case functions are called for each test case. This ensures that mutable objects can not leak across tests, for example.</p>
<p>That being said, <strong>if you are certain that your tests do not modify your cases data</strong>, there are several ways to solve this issue:</p>
<ul>
<li>the easiest way is to <strong>use fixtures with a broad scope</strong>, as explained <a href="#b-parametrizing-fixtures">above</a>. However in some parametrization scenarii, <code>pytest</code> does not guarantee that the fixture will be setup only once for the whole session, even if it is a session-scoped fixture. Also the cases will be parsed every time you run pytest, which might be cumbersome</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">parametrize</span><span class="p">,</span> <span class="n">parametrize_with_cases</span><span class="p">,</span> <span class="n">fixture</span>


<span class="nd">@parametrize</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">case_dummy</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="c1"># this is read only once per a, while there are 4 test runs </span>
    <span class="k">return</span> <span class="n">a</span>

<span class="nd">@fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;session&#39;</span><span class="p">)</span>
<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cached_a</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span>


<span class="nd">@parametrize</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">test_caching</span><span class="p">(</span><span class="n">cached_a</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">cached_a</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</code></pre></div>
<ul>
<li>
<p>an alternative is to use <code>functools.lru_cache</code> to explicitly set a memory cache on a case function. For simple cases you could simply decorate your case function with <code>@lru_cache(maxsize=1)</code> since simple case functions do not have arguments. However for case generators this is a bit more tricky to size the cache - the easiest thing is probably to let it to its default size of 128 with the no-argument version <code>@lru_cache</code>, or to remove the max limit and let it auto-grow, with <code>@lru_cache(max_size=None)</code>. See <a href="https://docs.python.org/3/library/functools.html#functools.lru_cache"><code>lru_cache</code> documentation for details</a>. Note that an older version of <code>pytest-cases</code> was offering some facilities to set the cache size, this has been removed from the library in version <code>2.0.0</code> as it seemed to provide little added value.</p>
</li>
<li>
<p>finally, you might wish to persist some cases on disk in order for example to avoid downloading them again from their original source, and/or to avoid costly processing on every pytest session. For this, the perfect match for you is to use <a href="https://joblib.readthedocs.io/en/latest/memory.html"><code>joblib</code>'s excellent <code>Memory</code> cache</a>. </p>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">If you add a cache mechanism, make sure that your test functions do not modify the returned objects !</p>
</div>
<h3 id="d-accessing-the-current-case">d- Accessing the current case<a class="headerlink" href="#d-accessing-the-current-case" title="Permanent link">&para;</a></h3>
<p>In some scenarii you may wish to access the case functions that are currently used to provide the parameter values. This may be</p>
<ul>
<li>to make your test behave differently depending on the case function, case id or case tags</li>
<li>to <code>pytest.skip</code> some combinations of parameters/cases that do not make sense</li>
<li>...</li>
</ul>
<p>With <code>pytest-cases</code> starting in version <code>3.5</code>, this is now possible thanks to the <code>current_cases</code> fixture. Simply use this fixture to get a dictionary containing the actual parameter id and case function for all parameters parametrized with cases in the current test node. Parametrized fixtures, if any, will appear in a sub-dictionary indexed by the fixture name.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">parametrize</span><span class="p">,</span> <span class="n">parametrize_with_cases</span><span class="p">,</span> <span class="n">fixture</span>

<span class="nd">@parametrize</span><span class="p">(</span><span class="n">nb</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span> <span class="nf">case_a</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">nb</span>

<span class="nd">@fixture</span>
<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="n">case_a</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_fixture</span><span class="p">(</span><span class="n">foo</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">foo</span>

<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="n">case_a</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_get_current_case</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">my_fixture</span><span class="p">,</span> <span class="n">current_cases</span><span class="p">):</span>

    <span class="c1"># access the case details for a test parameter</span>
    <span class="n">data_id</span><span class="p">,</span> <span class="n">data_fun</span><span class="p">,</span> <span class="n">data_params</span> <span class="o">=</span> <span class="n">current_cases</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

    <span class="c1"># access the case details for a fixture parameter</span>
    <span class="n">my_fixture_id</span><span class="p">,</span> <span class="n">my_fixture_fun</span><span class="p">,</span> <span class="n">my_fixture_params</span> <span class="o">=</span> <span class="n">current_cases</span><span class="p">[</span><span class="s2">&quot;my_fixture&quot;</span><span class="p">][</span><span class="s2">&quot;foo&quot;</span><span class="p">]</span>

    <span class="c1"># let&#39;s print all case information for this test node</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">current_cases</span><span class="p">)</span>
</code></pre></div>
<p>yields</p>
<div class="highlight"><pre><span></span><code>{&#39;data&#39;: Case(id=&#39;a&#39;, func=&lt;function case_a at 0x000001C0CAE9E700&gt;, params={&#39;nb&#39;: 1}), 
 &#39;my_fixture&#39;: {
     &#39;foo&#39;: Case(id=&#39;a&#39;, func=&lt;function case_a at 0x000001C0CAE9E700&gt;, params={&#39;nb&#39;: 1})
  }}
</code></pre></div>
<p>As you can see above, details are provided as <code>namedtuple</code>s. When a case itself is parametrized, its current parameter value(s) appear too (in the above example, <code>case_a</code> is parametrized with <code>nb</code>). This can be used to skip a test conditionally, for example:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="n">data_fun</span> <span class="ow">is</span> <span class="n">case_a</span> <span class="ow">and</span> <span class="n">data_params</span><span class="p">[</span><span class="s1">&#39;nb&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;This specific case is skipped&quot;</span><span class="p">)</span>
</code></pre></div>
<p>It can also be used to insert a debug breakpoint for a specific case.</p>
<p>To get more information on the case function, you can use <code>get_case_marks(func)</code>, <code>get_case_tags(func)</code>. You can also use <code>matches_tag_query(...)</code> to check if a case function matches some expectations either concerning its id or its tags. See <a href="api_reference/#matches_tag_query">API reference</a>.</p>
<p>Note: you can get the same information from a pytest hook, using the <code>get_current_cases</code> function. See <a href="api_reference/#get_current_cases">API reference</a> for details.</p>
<h3 id="e-test-ids">e- Test ids<a class="headerlink" href="#e-test-ids" title="Permanent link">&para;</a></h3>
<p>Starting from version 3.0.0, test ids induced by <code>@parametrize_with_cases</code> are similar to the ids induced by <code>@pytest.mark.parametrize</code>, even if a case function is itself parametrized or requires a fixture. In some situations you may wish to get a better control on the test ids.</p>
<p>For this you can pass a callable to <code>@parametrize_with_cases(ids=&lt;callable&gt;)</code>. In this callable, you may wish to use <code>get_case_id</code>, <code>get_case_marks</code>, <code>get_case_tags</code>, or <code>matches_tag_query</code> to return a custom id.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">parametrize</span><span class="p">,</span> <span class="n">parametrize_with_cases</span><span class="p">,</span> <span class="n">case</span><span class="p">,</span> <span class="n">get_case_id</span>

<span class="k">def</span> <span class="nf">case_hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;hello !&quot;</span>

<span class="nd">@case</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;hello_world&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">case_basic2</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;hello, world !&quot;</span>

<span class="nd">@case</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;hello_name&quot;</span><span class="p">)</span>
<span class="nd">@parametrize</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;you&quot;</span><span class="p">,</span> <span class="s2">&quot;earthling&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">case_basic3</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;hello, </span><span class="si">%s</span><span class="s2"> !&quot;</span> <span class="o">%</span> <span class="n">name</span>

<span class="k">def</span> <span class="nf">myidgen</span><span class="p">(</span><span class="n">case_fun</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom test case id&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;#</span><span class="si">%s</span><span class="s2">#&quot;</span> <span class="o">%</span> <span class="n">get_case_id</span><span class="p">(</span><span class="n">case_fun</span><span class="p">)</span>

<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;msg&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="n">myidgen</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div>
<p><code>pytest -s -v</code> yields:</p>
<div class="highlight"><pre><span></span><code>============================= test session starts =============================
platform win32 -- Python 3.7.3, pytest-5.3.5, py-1.9.0, pluggy-0.13.1
cachedir: .pytest_cache
(...)

test_doc_ids_debug.py::test_foo[#hello#] 
test_doc_ids_debug.py::test_foo[#hello_world#] 
test_doc_ids_debug.py::test_foo[#hello_name#-you] 
test_doc_ids_debug.py::test_foo[#hello_name#-earthling] 

============================== 4 passed in 0.07s ==============================
</code></pre></div>
<h3 id="f-debugging">f- Debugging<a class="headerlink" href="#f-debugging" title="Permanent link">&para;</a></h3>
<p>When all of your case functions are simple, <code>@parametrize_with_cases</code> generates a <code>@parametrize</code> decorator with argvalues being a list of <code>lazy_value(&lt;case_func&gt;)</code> for all of them. This in turn falls back to a good old <code>@pytest.mark.parametrize</code>, so the behaviour is close to what you are used to see when using <code>pytest</code>.</p>
<p>However when at least one case function is complex, typically when it requires a fixture, then <code>@parametrize_with_cases</code> wraps it into a fixture and passes a <code>fixture_ref(&lt;fixture_wrapping_case&gt;)</code> to <code>@parametrize</code>. This creates a so-called "fixture union": tests are not any more a cross-product of parameters, but a tree. This new feature brought by pytest-cases is not present in <code>pytest</code> by default, and adds a layer of complexity. But good news: starting in pytest-cases 3.0.0, this complexity is entirely hidden. In other words, generated test ids do not differ between this mode, and the simple mode. For debugging purposes however, you might wish to make this visible by setting <code>idstyle</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">parametrize</span><span class="p">,</span> <span class="n">parametrize_with_cases</span><span class="p">,</span> <span class="n">case</span><span class="p">,</span> <span class="n">fixture</span>

<span class="k">def</span> <span class="nf">case_hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;hello !&quot;</span>

<span class="nd">@fixture</span>
<span class="nd">@parametrize</span><span class="p">(</span><span class="s2">&quot;_name&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;you&quot;</span><span class="p">,</span> <span class="s2">&quot;earthling&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="n">_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_name</span>

<span class="nd">@case</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;hello_fixture&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">case_basic3</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;hello, </span><span class="si">%s</span><span class="s2"> !&quot;</span> <span class="o">%</span> <span class="n">name</span>

<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;msg&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">idstyle</span><span class="o">=</span><span class="s2">&quot;nostyle&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_default_idstyle</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;msg&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">idstyle</span><span class="o">=</span><span class="s2">&quot;compact&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_compact_idstyle</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="nd">@parametrize_with_cases</span><span class="p">(</span><span class="s2">&quot;msg&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">idstyle</span><span class="o">=</span><span class="s2">&quot;explicit&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_explicit_idstyle</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div>
<p><code>pytest -s -v</code> yields</p>
<div class="highlight"><pre><span></span><code>test_doc_debug.py::test_default_idstyle[hello] 
test_doc_debug.py::test_default_idstyle[hello_fixture-you] 
test_doc_debug.py::test_default_idstyle[hello_fixture-earthling] 
test_doc_debug.py::test_compact_idstyle[\hello] 
test_doc_debug.py::test_compact_idstyle[\hello_fixture-you] 
test_doc_debug.py::test_compact_idstyle[\hello_fixture-earthling] 
test_doc_debug.py::test_explicit_idstyle[msg\hello] 
test_doc_debug.py::test_explicit_idstyle[msg\hello_fixture-you] 
test_doc_debug.py::test_explicit_idstyle[msg\hello_fixture-earthling] 
</code></pre></div>
<p>See also <a href="pytest_goodies/#parametrize"><code>@parametrize</code> documentation</a> for details.</p>
<h2 id="main-features-benefits">Main features / benefits<a class="headerlink" href="#main-features-benefits" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><strong>Separation of concerns</strong>: test code on one hand, test cases data on the other hand. This is particularly relevant for data science projects where a lot of test datasets are used on the same block of test code.</p>
</li>
<li>
<p><strong>Everything in the test case or in the fixture</strong>, not outside. A side-effect of <code>@pytest.mark.parametrize</code> is that users tend to create or parse their datasets outside of the test function. <code>pytest_cases</code> suggests a model where the potentially time and memory consuming step of case data generation/retrieval is performed <em>inside</em> the test node or the required fixture, thus keeping every test case run more independent. It is also easy to put debug breakpoints on specific test cases.</p>
</li>
<li>
<p><strong>User experience fully aligned with pytest</strong>. Cases collection and filtering, cases parametrization, cases output unpacking as test arguments, cases using fixtures... all of this will look very familiar to <code>pytest</code> users.</p>
</li>
</ul>
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">&para;</a></h2>
<h3 id="pytest"><code>pytest</code><a class="headerlink" href="#pytest" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://docs.pytest.org/en/latest/parametrize.html">pytest documentation on parametrize</a></li>
<li><a href="https://docs.pytest.org/en/latest/fixture.html#fixture-parametrize">pytest documentation on fixtures</a></li>
<li><a href="https://smarie.github.io/python-pytest-steps/">pytest-steps</a></li>
<li><a href="https://smarie.github.io/python-pytest-harvest/">pytest-harvest</a></li>
<li><a href="https://smarie.github.io/pytest-patterns/">pytest-patterns</a> for examples showing how to combine the various plugins to create data science benchmarks.</li>
</ul>
<h3 id="others">Others<a class="headerlink" href="#others" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://smarie.github.io/python-makefun/">makefun</a> is used to dynamically generate functions or modify user-provided function signatures.</li>
<li><a href="https://smarie.github.io/python-decopatch/">decopatch</a> is used to create decorators.</li>
</ul>
<p><em>Do you like this library ? You might also like <a href="https://github.com/smarie/OVERVIEW#python">my other python libraries</a></em> </p>
<h2 id="want-to-contribute">Want to contribute ?<a class="headerlink" href="#want-to-contribute" title="Permanent link">&para;</a></h2>
<p>Details on the github page: <a href="https://github.com/smarie/python-pytest-cases">https://github.com/smarie/python-pytest-cases</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
    
  </body>
</html>