
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../pytest_goodies/">
      
      
        <link rel="next" href="../api_reference/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38">
    
    
      
        <title>fixture unions theory - pytest_cases</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#theory-behind-fixture_union" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="pytest_cases" class="md-header__button md-logo" aria-label="pytest_cases" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pytest_cases
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              fixture unions theory
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/smarie/python-pytest-cases" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="pytest_cases" class="md-nav__button md-logo" aria-label="pytest_cases" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    pytest_cases
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/smarie/python-pytest-cases" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pytest_goodies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pytest goodies
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    fixture unions theory
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    fixture unions theory
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-how-pytest-works-today" class="md-nav__link">
    <span class="md-ellipsis">
      1. How pytest works today
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-extension-to-fixture-unions" class="md-nav__link">
    <span class="md-ellipsis">
      2. Extension to fixture unions.
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-how-pytest-works-today" class="md-nav__link">
    <span class="md-ellipsis">
      1. How pytest works today
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-extension-to-fixture-unions" class="md-nav__link">
    <span class="md-ellipsis">
      2. Extension to fixture unions.
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="theory-behind-fixture_union">Theory behind <a href="../pytest_goodies/#fixture_union"><code>fixture_union</code></a><a class="headerlink" href="#theory-behind-fixture_union" title="Permanent link">&para;</a></h1>
<h2 id="1-how-pytest-works-today">1. How <code>pytest</code> works today<a class="headerlink" href="#1-how-pytest-works-today" title="Permanent link">&para;</a></h2>
<p>As of <code>pytest</code> 5, there are three kind of concepts at play to generate the list of test nodes and their received parameters ("call spec" in pytest internals).</p>
<ul>
<li>
<p>test functions are the functions defined with <code>def test_&lt;name&gt;(&lt;args&gt;)</code>.</p>
</li>
<li>
<p>they can be parametrized using <code>@pytest.mark.parametrize</code> (or our enhanced version <a href="../pytest_goodies/#parametrize"><code>@parametrize</code></a>). That means that some of the <code>&lt;args&gt;</code> will take several values, and for each combination a distinct test node will be created</p>
</li>
<li>
<p>they can require <em>fixtures</em>, that is, functions decorated with <code>@pytest.fixture</code> (or our enhanced version <a href="../pytest_goodies/#fixture"><code>@fixture</code></a>). That means that some of the <code>&lt;args&gt;</code> will take the value of the corresponding fixture(s).</p>
</li>
<li>
<p>fixtures can be parametrized too (with <a href="../pytest_goodies/#fixture"><code>@fixture</code></a> it is easier :) ), and can require other fixtures.</p>
</li>
<li>
<p>finally fixtures can enable an "auto-use" mode, so that they are called even when not explicitly required by anything.</p>
</li>
</ul>
<p>Therefore, a test plan can be represented as an acyclic directed graph of fixtures, where nodes are fixtures and edges represent dependencies. On top of this layout, we can overlay the information of which fixture nodes are parametrized, which ones are required by which test function, and which test function is parametrized. The resulting figure is presented below:</p>
<p><img alt="fixture graph pytest" src="../imgs/3_fixture_graph_pytest.png" /></p>
<p>The following code can be used to easily check the number of tests run. Note that we use <code>@fixture</code> and <code>@parametrize</code> from <code>pytest-cases</code> to ease code readability here but you would get a similar behaviour with <code>@pytest.fixture</code> and <code>@pytest.mark.parametrize</code> (the test ids would not show the parameter names by default though, which is helpful for our demonstration here).</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">fixture</span><span class="p">,</span> <span class="n">parametrize</span>

<span class="nd">@fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@parametrize</span><span class="p">(</span><span class="n">ie</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">e</span><span class="p">(</span><span class="n">ie</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;e</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ie</span>

<span class="nd">@fixture</span>
<span class="k">def</span> <span class="nf">d</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;d&quot;</span>

<span class="nd">@fixture</span>
<span class="k">def</span> <span class="nf">c</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;c&quot;</span>

<span class="nd">@fixture</span>
<span class="nd">@parametrize</span><span class="p">(</span><span class="n">ia</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">ia</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;a</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ia</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">d</span>

<span class="nd">@parametrize</span><span class="p">(</span><span class="n">i2</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i2</span><span class="p">):</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">i2</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;a0cdx&quot;</span><span class="p">,</span> <span class="s2">&quot;a0cdz&quot;</span><span class="p">,</span> <span class="s2">&quot;a1cdx&quot;</span><span class="p">,</span> <span class="s2">&quot;a1cdz&quot;</span><span class="p">)</span>

<span class="nd">@fixture</span>
<span class="nd">@parametrize</span><span class="p">(</span><span class="n">ib</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">ib</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;b</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ib</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">a</span>

<span class="k">def</span> <span class="nf">test_1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;a0cd&quot;</span><span class="p">,</span> <span class="s2">&quot;a1cd&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
    <span class="k">assert</span> <span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;bxc&quot;</span><span class="p">,</span> <span class="s2">&quot;bzc&quot;</span><span class="p">)</span>
</code></pre></div>
<p>calling <code>pytest</code> yields:</p>
<div class="highlight"><pre><span></span><code>============================= test session starts =============================
collecting ... collected 16 items

test_doc_fixture_graph.py::test_2[ie=-1-ia=0-i2=x] 
test_doc_fixture_graph.py::test_2[ie=-1-ia=0-i2=z] 
test_doc_fixture_graph.py::test_2[ie=-1-ia=1-i2=x] 
test_doc_fixture_graph.py::test_2[ie=-1-ia=1-i2=z] 
test_doc_fixture_graph.py::test_2[ie=1-ia=0-i2=x] 
test_doc_fixture_graph.py::test_2[ie=1-ia=0-i2=z] 
test_doc_fixture_graph.py::test_2[ie=1-ia=1-i2=x] 
test_doc_fixture_graph.py::test_2[ie=1-ia=1-i2=z] 
test_doc_fixture_graph.py::test_1[ie=-1-ia=0-ib=x] 
test_doc_fixture_graph.py::test_1[ie=-1-ia=0-ib=z] 
test_doc_fixture_graph.py::test_1[ie=-1-ia=1-ib=x] 
test_doc_fixture_graph.py::test_1[ie=-1-ia=1-ib=z] 
test_doc_fixture_graph.py::test_1[ie=1-ia=0-ib=x] 
test_doc_fixture_graph.py::test_1[ie=1-ia=0-ib=z] 
test_doc_fixture_graph.py::test_1[ie=1-ia=1-ib=x] 
test_doc_fixture_graph.py::test_1[ie=1-ia=1-ib=z] 

============================= 16 passed in 0.14s ==============================
</code></pre></div>
<p>So each test is called 8 times. How are these calls computed ?</p>
<ul>
<li>first for each test, <code>pytest</code> computes the set of all fixtures that are directly or indirectly required to run it. This is known as the "fixture closure". So for <code>test_1</code> this closure is <code>{a, b, c, d, e}</code> while for test 2 it is <code>{a, c, d, e}</code>. We can show this on the following picture:</li>
</ul>
<p><img alt="fixture graph pytest closure" src="../imgs/4_fixture_graph_pytest_closure.png" /></p>
<ul>
<li>then a cartesian product is made across the parameters of all parametrization marks found on any item in the closure (including parameters of the test itself), So for <code>test_1</code> the cartesian product is <code>&lt;ie&gt; x &lt;ia&gt; x &lt;ib&gt;</code> while for <code>test_2</code> it is <code>&lt;ie&gt; x &lt;ia&gt; x &lt;i2&gt;</code>. This is why both tests result in having 8 variants being called (see details in the test ids above).</li>
</ul>
<h2 id="2-extension-to-fixture-unions">2. Extension to fixture unions.<a class="headerlink" href="#2-extension-to-fixture-unions" title="Permanent link">&para;</a></h2>
<p>A fixture union is by definition a fixture that is parametrized to alternately depend on other fixtures. We will represent this in the figures with a special dashed orange arrow, to remind that a special parameter is associated with the selection of which arrow is activated. </p>
<p>Let's consider the following modification of the above example, where we introduce two "unions": one as an explicit fixture <code>u</code>, and the other implicitly created by using <code>fixture_ref</code>s in the parametrization of <code>b</code>.</p>
<p><img alt="fixture graph union" src="../imgs/5_fixture_graph_union.png" /></p>
<p>We can create such a configuration with a slight modification to the above example:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">fixture</span><span class="p">,</span> <span class="n">parametrize</span><span class="p">,</span> <span class="n">fixture_ref</span><span class="p">,</span> <span class="n">fixture_union</span>

<span class="p">(</span><span class="o">...</span> <span class="n">same</span> <span class="k">as</span> <span class="n">above</span> <span class="o">...</span><span class="p">)</span>

<span class="nd">@fixture</span>
<span class="nd">@parametrize</span><span class="p">(</span><span class="n">ib</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">])</span>
<span class="nd">@parametrize</span><span class="p">(</span><span class="n">ub</span><span class="o">=</span><span class="p">(</span><span class="n">fixture_ref</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">fixture_ref</span><span class="p">(</span><span class="n">c</span><span class="p">)),</span> <span class="n">idstyle</span><span class="o">=</span><span class="s2">&quot;explicit&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="n">ub</span><span class="p">,</span> <span class="n">ib</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;b</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ib</span> <span class="o">+</span> <span class="n">ub</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">fixture_union</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">idstyle</span><span class="o">=</span><span class="s2">&quot;explicit&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_1</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div>
<p>Note the <code>idstyle="explicit"</code> keyword arguments, that will help us get more details in the test ids.</p>
<p>Calling <code>pytest</code> yields:</p>
<div class="highlight"><pre><span></span><code>============================= test session starts =============================
collecting ... collected 24 items

test_doc_fixture_graph_union.py::test_2[ie=-1-ia=0-i2=x] PASSED          [  4%]
test_doc_fixture_graph_union.py::test_2[ie=-1-ia=0-i2=z] PASSED          [  8%]
test_doc_fixture_graph_union.py::test_2[ie=-1-ia=1-i2=x] PASSED          [ 12%]
test_doc_fixture_graph_union.py::test_2[ie=-1-ia=1-i2=z] PASSED          [ 16%]
test_doc_fixture_graph_union.py::test_2[ie=1-ia=0-i2=x] PASSED           [ 20%]
test_doc_fixture_graph_union.py::test_2[ie=1-ia=0-i2=z] PASSED           [ 25%]
test_doc_fixture_graph_union.py::test_2[ie=1-ia=1-i2=x] PASSED           [ 29%]
test_doc_fixture_graph_union.py::test_2[ie=1-ia=1-i2=z] PASSED           [ 33%]
test_doc_fixture_graph_union.py::test_1[ie=-1-u\a-ia=0] PASSED           [ 37%]
test_doc_fixture_graph_union.py::test_1[ie=-1-u\a-ia=1] PASSED           [ 41%]
test_doc_fixture_graph_union.py::test_1[ie=-1-u\b-ib=x-ub\a-ia=0] PASSED [ 45%]
test_doc_fixture_graph_union.py::test_1[ie=-1-u\b-ib=x-ub\a-ia=1] PASSED [ 50%]
test_doc_fixture_graph_union.py::test_1[ie=-1-u\b-ib=x-ub\c]  PASSED     [ 54%]
test_doc_fixture_graph_union.py::test_1[ie=-1-u\b-ib=z-ub\a-ia=0] PASSED [ 58%]
test_doc_fixture_graph_union.py::test_1[ie=-1-u\b-ib=z-ub\a-ia=1] PASSED [ 62%]
test_doc_fixture_graph_union.py::test_1[ie=-1-u\b-ib=z-ub\c] PASSED      [ 66%]
test_doc_fixture_graph_union.py::test_1[ie=1-u\a-ia=0] PASSED            [ 70%]
test_doc_fixture_graph_union.py::test_1[ie=1-u\a-ia=1] PASSED            [ 75%]
test_doc_fixture_graph_union.py::test_1[ie=1-u\b-ib=x-ub\a-ia=0] PASSED  [ 79%]
test_doc_fixture_graph_union.py::test_1[ie=1-u\b-ib=x-ub\a-ia=1] PASSED  [ 83%]
test_doc_fixture_graph_union.py::test_1[ie=1-u\b-ib=x-ub\c] PASSED       [ 87%]
test_doc_fixture_graph_union.py::test_1[ie=1-u\b-ib=z-ub\a-ia=0] PASSED  [ 91%]
test_doc_fixture_graph_union.py::test_1[ie=1-u\b-ib=z-ub\a-ia=1] PASSED  [ 95%]
test_doc_fixture_graph_union.py::test_1[ie=1-u\b-ib=z-ub\c] PASSED       [100%]

======================== 24 passed, 1 warning in 0.30s ========================
</code></pre></div>
<p>Now 24 tests were created ! <code>test_2</code> still has 8 runs, which is normal as it does not depend on any union fixture. Let's try to understand what happened to parametrization of <code>test_1</code>. It is actually fairly simple: </p>
<ul>
<li>
<p>first a global fixture closure is created as usual, consisting in <code>{u, a, b, c, d, e}</code></p>
</li>
<li>
<p>then for each union fixture in <code>test_1</code>'s closure, starting from the bottom of the graph, we generate several closures by activating each of the arrows in turn. We progress upwards through the graph of remaining dependencies for each alternative:</p>
<ul>
<li>first <code>u</code> is used to split between subgraphs <code>u\a</code> and <code>u\b</code></li>
<li>subgraph <code>u\a</code> does not contain any union. Its final closure is <code>{u, a, c, d, e}</code></li>
<li>
<p>for subgraph <code>u\b</code> there is another union. So a new split is generated:</p>
<ul>
<li>subgraph <code>u\b-ub\a</code> does not contain any union. Its final closure is <code>{u, b, a, c, d, e}</code></li>
<li>subgraph <code>u\b-ub\c</code> does not contain any union. Its final closure is <code>{u, b, c, e}</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>So the result consists in <strong>3 alternate fixture closures</strong> for <code>test_1</code>:</p>
<p><img alt="fixture graph union closures" src="../imgs/6_fixture_graph_union_closures.png" /></p>
<ul>
<li>
<p>finally, as usual, for each closure a cartesian product is made across the parameters of all parametrization marks found on any item in the closure (including parameters of the test itself), So </p>
<ul>
<li>for <code>test_1</code> alternative <code>u\a</code>, the cartesian product is <code>&lt;ie&gt; x &lt;ia&gt;</code>  (4 tests) </li>
<li>for <code>test_1</code> alternative <code>u\b-ub\a</code>, the cartesian product is <code>&lt;ie&gt; x &lt;ia&gt; x &lt;ib&gt;</code>  (8 tests) </li>
<li>for <code>test_1</code> alternative <code>u\b-ub\c</code>, the cartesian product is <code>&lt;ie&gt; x &lt;ib&gt;</code>  (4 tests) </li>
<li>for <code>test_2</code> it is <code>&lt;ie&gt; x &lt;ia&gt; x &lt;i2&gt;</code>. (8 tests).</li>
</ul>
</li>
</ul>
<p>The total is indeed 4 + 8 + 4 + 8 = 24 tests. Once again the test ids may be used to check that everything is correct, see above.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
    
  </body>
</html>